import 'dart:convert';

import 'package:dio/dio.dart';
import 'package:surfy_mobile_app/cache/qr/qr_cache.dart';
import 'package:surfy_mobile_app/entity/blockchain/blockchains.dart';
import 'package:surfy_mobile_app/entity/token/token.dart';
import 'package:surfy_mobile_app/logger/logger.dart';
import 'package:surfy_mobile_app/utils/dio_utils.dart';

class QRService {
  QRService({required this.cache});
  final QrCache cache;

  Future<String?> getCachedWalletQR(Token token, Blockchain blockchain, String address) async {
    return await cache.getWalletQR(token, blockchain, address);
  }

  Future<String?> getCachedMerchantQR(String merchantId) async {
    return await cache.getMerchantQR(merchantId);
  }

  Future<void> setWalletQR(Token token, Blockchain blockchain, String address, String qrUrl) async {
    logger.d('Set wallet qr: $token, $blockchain, $address, $qrUrl');
    await cache.setWalletQR(token, blockchain, address, qrUrl);
  }

  Future<void> setMerchantQR(String merchantId, String qrUrl) async {
    await cache.setMerchantQR(merchantId, qrUrl);
  }

  Future<String> getQRcode(String url) async {
    logger.d('Get qrcode from remote');
    final req = await dioObject.post("https://api.qr.io/v1/create", data: {
      "apikey": "hPBWEtNOCqX8QIv4rR0M",
      "data": url,
      "transparent":"off",
      "frontcolor":"#000000",
      "marker_out_color":"#000000",
      "marker_in_color":"#000000",
      "pattern":"special-circle",
      "marker":"rounded",
      "marker_in":"rounded",
      "no_logo_bg": "on",
      "optionlogo": surfyLogo
    }, options: Options(responseType: ResponseType.json));

    final json = jsonDecode(req.data);

    return json["png"];
  }
}

final surfyLogo = "data:image/png;base64,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";